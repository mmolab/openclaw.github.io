---
import type { ImageMetadata } from 'astro';
import BaseLayout from './BaseLayout.astro';
import Header from '@/components/layout/Header.astro';
import Footer from '@/components/layout/Footer.astro';
import Breadcrumbs from '@/components/seo/Breadcrumbs.astro';
import ArticleHero from '@/components/blog/ArticleHero.astro';
import ShareButtons from '@/components/blog/ShareButtons.astro';

interface Props {
  title: string;
  description: string;
  publishedAt: Date;
  updatedAt?: Date;
  author?: string;
  headerImage?: string;
  tags?: string[];
  slug?: string;
}

const {
  title,
  description,
  publishedAt,
  updatedAt,
  author = 'ClawDaily Writer',
  headerImage,
  tags = [],
  slug = '',
} = Astro.props;

// L·∫•y ng√¥n ng·ªØ t·ª´ slug b√†i vi·∫øt (v√≠ d·ª•: vi/chao-mung...)
const lang = slug.split('/')[0] === 'vi' ? 'vi' : 'en';

const breadcrumbs = [
  { label: lang === 'en' ? 'Home' : 'Trang ch·ªß', href: `/${lang}/` },
  { label: lang === 'en' ? 'Articles' : 'B√†i vi·∫øt', href: `/${lang}/blog/` },
  { label: title },
];

const nav = [
  { label: lang === 'en' ? 'Articles' : 'B√†i vi·∫øt', href: `/${lang}/blog` },
  { label: lang === 'en' ? 'About' : 'Gi·ªõi thi·ªáu', href: `/${lang}/about` },
  { label: lang === 'en' ? 'Contact' : 'Li√™n h·ªá', href: `/${lang}/contact` },
];

const fullUrl = new URL(Astro.url.pathname, Astro.site).toString();
const targetLang = lang === 'en' ? 'vi' : 'en';
// Khi ·ªü trang chi ti·∫øt, chuy·ªÉn switcher s·∫Ω v·ªÅ trang ch·ªß c·ªßa ng√¥n ng·ªØ kia ƒë·ªÉ ƒë·∫£m b·∫£o b√†i vi·∫øt c√≥ b·∫£n d·ªãch
const switchHref = `/${targetLang}/`;
---

<BaseLayout
  title={title}
  description={description}
  image={headerImage}
>
  <Header
    slot="header"
    position="fixed"
    size="md"
    nav={nav}
    showCta={false}
    actions={[
      {
        icon: 'globe',
        href: switchHref,
        label: lang === 'en' ? 'Ti·∫øng Vi·ªát üáªüá≥' : 'English üá∫üá∏',
        iconOnly: false,
      },
    ]}
  />

  <ArticleHero
    title={title}
    description={description}
    publishedAt={publishedAt}
    updatedAt={updatedAt}
    author={author}
    tags={tags}
    headerImage={headerImage}
  />

  <article class="py-12">
    <div class="mx-auto max-w-4xl px-6">
      <Breadcrumbs items={breadcrumbs} class="mb-8" />
      <div class="prose prose-lg prose-headings:font-display prose-headings:font-bold prose-a:text-brand-600 hover:prose-a:text-brand-500 dark:prose-invert max-w-none">
        <slot />
      </div>

      <footer class="border-border mt-12 border-t pt-8">
        <div class="flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between">
          <a href={`/${lang}/blog`} class="text-brand-600 hover:text-brand-500 dark:text-brand-400 inline-flex items-center gap-2 text-sm font-medium transition-colors">
            ‚Üê {lang === 'en' ? 'Back to Articles' : 'Quay l·∫°i b√†i vi·∫øt'}
          </a>
          <ShareButtons title={title} url={fullUrl} />
        </div>
      </footer>
    </div>
  </article>

  <Footer slot="footer" layout="simple" background="secondary" showCopyright={true} />
</BaseLayout>
