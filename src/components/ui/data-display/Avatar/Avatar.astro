---
/**
 * Avatar Component
 * Displays user avatars with fallback initials
 */
import type { HTMLAttributes } from 'astro/types';
import { cn } from '@/lib/cn';
import { avatarVariants } from './avatar.variants';

interface Props extends HTMLAttributes<'div'> {
  src?: string;
  alt?: string;
  fallback?: string;
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
}

const { src, alt = '', fallback, size = 'md', class: className, ...attrs } = Astro.props;

// Generate initials from alt text or fallback
const initials = fallback || alt
  .split(' ')
  .map((word) => word[0])
  .join('')
  .slice(0, 2)
  .toUpperCase();
---

<div class={cn(avatarVariants({ size }), className)} {...attrs}>
  {src ? (
    <img
      src={src}
      alt={alt}
      class="w-full h-full object-cover"
      loading="lazy"
      decoding="async"
      onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
    />
    <span class="hidden items-center justify-center w-full h-full" aria-hidden="true">
      {initials || '?'}
    </span>
  ) : (
    <span aria-hidden="true">{initials || '?'}</span>
  )}
  <span class="sr-only">{alt || 'User avatar'}</span>
</div>
